- name: "Install prereqs"
  when: ansible_os_family == "Darwin"
  homebrew:
    name:
      - openssl
      - readline
      - sqlite3
      - xz
      - zlib

- name: "Install prereqs"
  when: ansible_os_family == "Debian"
  apt:
    name:
      - make
      - build-essential
      - libssl-dev
      - zlib1g-dev
      - libbz2-dev
      - libreadline-dev
      - libsqlite3-dev
      - wget
      - curl
      - llvm
      - libncurses5-dev
      - xz-utils
      - tk-dev
      - libxml2-dev
      - libxmlsec1-dev
      - libffi-dev
      - liblzma-dev

- name: "Get latest python version"
  shell: asdf latest python
  register: python_latest

- name: "Install python@{{ python_latest.stdout }}"
  register: asdf_python_installed
  changed_when: '"already added" not in asdf_python_installed.stdout'
  failed_when:
    - asdf_python_installed.rc != 0
    - '"already added" not in asdf_python_installed.stderr'
  shell: "asdf install python {{ python_latest.stdout }}"

- name: "Set global to python@{{ python_latest.stdout }}"
  shell: "asdf global python {{ python_latest.stdout }}"

- name: "Install additional python version"
  when: python_versions is defined and (python_versions | length > 0)
  shell: "asdf install python {{ item }}"
  loop: python_versions
